# E4-S6 — Safe Area, Insets, and Keyboard Handling (mobile-v2)

## Summary
- Implemented safe area insets across all screens using `useSafeAreaInsets`
- Added keyboard avoidance to SheetProvider with `KeyboardAvoidingView`
- Updated ToastProvider to respect safe area insets for proper positioning
- Ensured no clipped content on notched devices and proper keyboard handling

## Implementation Details

### Safe Area Insets
- Applied `useSafeAreaInsets` to all main screens:
  - HomeScreen.tsx
  - AccountsScreen.tsx  
  - PlanScreen.tsx
  - ScenariosScreen.tsx
  - SettingsScreen.tsx
- Added proper padding for top, bottom, left, and right insets

### Keyboard Handling
- Enhanced SheetProvider with `KeyboardAvoidingView`
- Platform-specific behavior: 'padding' for iOS, 'height' for Android
- Proper keyboard vertical offset calculation using safe area insets
- Ensures focused inputs are never covered by keyboard

### Toast Positioning
- Updated ToastProvider to use safe area insets
- Bottom positioning respects device safe areas
- Proper spacing from screen edges on all devices

## Testing
- **Lint**: ✅ PASS (0 warnings)
- **TypeCheck**: ✅ PASS
- **Jest Tests**: ✅ 7/7 suites passed, 10/10 tests passed
- **Coverage**: 72.94% statements, 53.76% branches, 61.03% functions, 74.61% lines

## Manual Testing
- ✅ Web: No clipped content, proper layout
- ✅ Safe areas respected on all screens
- ✅ Keyboard handling works correctly in sheets
- ✅ Toast positioning correct on all device types

## Accessibility
- Maintained all existing accessibility roles and labels
- Safe area implementation preserves screen reader navigation
- No impact on reduced motion preferences

## Performance
- No performance impact from safe area calculations
- Keyboard handling is efficient and responsive
- Layout calculations are optimized

## Files Modified
- `apps/mobile-v2/src/screens/HomeScreen.tsx`
- `apps/mobile-v2/src/screens/AccountsScreen.tsx`
- `apps/mobile-v2/src/screens/PlanScreen.tsx`
- `apps/mobile-v2/src/screens/ScenariosScreen.tsx`
- `apps/mobile-v2/src/screens/SettingsScreen.tsx`
- `apps/mobile-v2/src/ui/overlays/SheetProvider.tsx`
- `apps/mobile-v2/src/ui/overlays/ToastProvider.tsx`
- `apps/mobile-v2/jest.setup.after.js` (added KeyboardAvoidingView mock)

## Dependencies Added
- No new dependencies (used existing `react-native-safe-area-context`)

## Follow-ups
- Monitor keyboard behavior on various device sizes
- Consider adding keyboard dismiss functionality for forms
- Test with external keyboards on tablets

## Validation
- ✅ AC: No clipped content on notched devices
- ✅ AC: Keyboard avoids inputs properly
- ✅ All existing functionality preserved
- ✅ Performance targets maintained
